<div class="container">
  <mat-toolbar color="primary">
    <div class="mt-1">
        <h3 *ngIf="currentKomm.id ===undefined">Neue Kommissionierung Erstellen</h3>
        <h3 *ngIf="currentKomm.id !==undefined">Kommissionierung aktualisieren</h3>
    </div>
  </mat-toolbar>
  <div matDialogContent class="DialogContent">
    <div class="mt-2 col-md-12"></div>
    <form [formGroup]="kommissForm">
      <input type="hidden" formControlName="id" name="id">
      <div class="row">
       <div class="col  ">
        <div class="mb-3">
          <label for="verkauferId" class="fs-s "> Verkaufer</label>
          <input type="hidden"
            class="form-control form-control-sm fs-s" formControlName="verkauferId" name="verkauferId" id="verkauferId" aria-describedby="helpId" placeholder="hier sollte benutzer nr sein" (ngValue)="verkaufer">
            <div class="form-control form-control-sm">{{verkauferData.username}}</div>
        </div>
       </div>
       <div class="col">
        <div class="mb-3">
          <label for="maxPalettenHoher" class="fs-s">Maximale Palettenhöhe </label>
          <input type="number"
            class="form-control form-control-sm fs-s" formControlName="maxPalettenHoher" name="maxPalettenHoher" id="maxPalettenHoher" aria-describedby="helpId" placeholder="">
        </div>
       </div>
       <div class="col  ">
        <div class="mb-3">
          <label for="gewunschtesLieferDatum" class="fs-s">Gewünschte Lieferdatum</label>
          <input type="date"
            class="form-control form-control-sm fs-s" formControlName="gewunschtesLieferDatum" name="gewunschtesLieferDatum" id="gewunschtesLieferDatum" aria-describedby="helpId" placeholder="">
        </div>
       </div>
      </div>
      <div class="row">
        <div class="col  ">
            <div class="mb-3">
              <label for="dispositorId" class="fs-s">Debitor</label>
              <select formControlName="dispositorId" class="form-select form-select-sm fs-s" name="dispositorId" id="dispositorId">
                <option *ngFor="let item of dispo | filterNullItemPipe; let i = index; " [ngValue]="item?.id">{{item?.name}}</option>
              </select>
          </div>
         </div>
         <div class="col  ">
          <div class="mb-3">
              <label for="" class="fs-s">Kommissionierung Status</label>
              <select formControlName="kommissStatus" class="form-select form-select-sm fs-s" name="kommissStatus" id="">
                <option *ngFor="let item of kommStatus | keyvalue" [ngValue]="item.value" >{{item.value}}</option>
              </select>
            <small id="helpId" class="form-text text-muted fs-ss"> Inbearbeitung, bereit kann man kommissioniren</small>
          </div>
         </div>
         <div class="col  ">
          <div class="mb-3">
              <label for="spedition" class="fs-s">Spedition</label>
              <select formControlName="spedition" class="form-select form-select-sm fs-s" name="spedition" id="spedition">
                <option *ngFor="let item of spedi | filterNullItemPipe; let i = index" [ngValue]="item?.id">{{item?.name}}</option>
              </select>
              <small id="helpId" class="form-text text-muted fs-ss"  *ngIf="spedi[spediSelected] !== undefined"> {{'Max lade gewicht: '+ spedi[spediSelected].maxLadeGewicht + ' Max paletten: ' + spedi[spediSelected].maxPalettenMenge}}</small>
          </div>
         </div>
      </div>
       <div class="row">
            <div class="col-md-6">
              <label for="versorungId" class="fs-s">Versorugungs Id</label>
              <input type="text"
                class="form-control form-control-sm fs-s" formControlName="versorungId" name="versorungId" id="versorungId" aria-describedby="helpId" placeholder="">
            </div>
            <div class="col-md-6 mt-2 mr-auto">
              <div>
                <label for="submitKom" class="fs-s"></label>
              </div>
              <button type="submit" id="submitKom" class="btn btn-primary fs-s" *ngIf="currentKomm.id ===undefined" (click)="saveKommissionierung(kommissForm.value)">Kommissionierung Spiechern</button>
              <button type="submit" id="submitKom" class="btn btn-primary fs-s" *ngIf="currentKomm.id !==undefined"(click)="updateKommissionierung(kommissForm.value)">Kommissionierung Aktualisieren</button>
              <div>
                <small id="submitKom" class="form-text text-muted fs-ss">Zuerst müsst die Kommissionierung gespeichert werden</small>
              </div>
            </div>
            <div class="row justify-content-center align-items-center g-2">
              <div class="col-md-4">
                <label for="lbeleg" class="fs-s">Logistic Beleg Nr</label>
                <input type="text"
                  class="form-control form-control-sm fs-s" #logisticBeleg placeholder="" id="lbeleg">
              </div>
              <div class="col-md-4 mt-3" >
                <button type="button" id="lbeleg" class="btn btn-primary fs-s" (click)="addlogisticBeleg(logisticBeleg.value)">Gib Logistic Beleg Nr ein</button>
              </div>
              <div class="col-md-4 mt-4">
                <button  id="zeigArtikel" class="btn btn-success fs-s" (click)="showArtikelsinKomm()">Zeig Artikeln</button>
                <div>
                  <small id="zeigArtikel" class="form-text text-muted fs-ss">Zeig Artikels in Kommissionierung</small>
                </div>
              </div>
            </div>
       </div>
    </form>
    <div class="mt-2 col-md-12"></div>
    <div class="table-responsive" *ngIf="showArtikelsInKomm === 1">
      <table class="table table-bordered border-success table-hover table-sortable">
        <thead>
          <tr class="border border-success">
            <th scope="col" class="fs-s">Artikel id:</th>
            <th scope="col" class="fs-s">Menge in Kommisionierung</th>
            <th scope="col" class="fs-s">Name</th>
            <th scope="col" class="fs-s">Artikel Status</th>
            <th scope="col" class="fs-s">Verkauf Price</th>
            <th scope="col" class="fs-s">Min Los Menge</th>
            <th scope="col" class="fs-s">Total Gewicht</th>
            <th scope="col" class="fs-s">Liferant</th>
            <th scope="col" class="fs-s">Logistic Beleg Nr</th>
            <th scope="col" class="fs-s">Neue Menge</th>
            <th scope="col" class="fs-s">Mengenänderung</th>
            <th scope="col" class="fs-s">Remove Position</th>
          </tr>
        </thead>
        <tbody>
          <tr   *ngFor="let item of artikelsInKomm; let i=index;" class="{{border[i]}}">
            <td class="fs-s">{{item.artId}}</td>
            <td class="fs-s">{{item.total}}</td>
            <td class="fs-s">{{item.name }}</td>
            <td class="fs-s">{{artikelStatus[i]}}</td>
            <td class="fs-s">{{item.verPrice}}</td>
            <td class="fs-s">{{item.minLosMenge}}</td>
            <td class="fs-s">{{item.gewicht}}</td>
            <td class="fs-s">{{dispo[item.liferantId].name}}</td>
            <td class="fs-s">{{item.logisticBelegNr}}</td>
            <td class="fs-s"><div class="mb-3">
              <input type="number"  value="artikelMenge" [(ngModel)]="artikelMengeEdit[i]"
                class="form-control form-control-sm fs-s" name="artikelMenge" id="artikelMenge" aria-describedby="helpId" placeholder="">
              <small id="helpId" class="form-text text-muted fs-ss">Total für diese Position!</small>
            </div></td>
            <td class="fs-s"><div class="d-grid gap-2">
              <button *ngIf="artikelStatus[i] === 'INPACKEN'" type="button" name="" id="" class="btn btn-primary fs-s" (click)="addArtikelToKomm(i, true) ">Bestätigen</button>
              <button *ngIf="artikelStatus[i] === 'GEPACKT' || artikelStatus[i] === 'TEILGEPACKT'" type="button" name="" id="" class="btn btn-primary fs-s" (click)="addArtikelToKomm(i, true) " disabled>Bestätigen</button>
            </div></td>
            <td class="fs-s"><div class="d-grid gap-2">
              <button *ngIf="artikelStatus[i] === 'INPACKEN'" type="button" name="" id="" class="btn btn-danger fs-s" (click)="deletePositionInKomm(i)">Delete</button>
              <button *ngIf="artikelStatus[i] === 'GEPACKT' || artikelStatus[i] === 'TEILGEPACKT'" type="button" name="" id="" class="btn btn-danger fs-s" (click)="deletePositionInKomm(i)" disabled>Delete</button>
            </div></td>
          </tr>
        </tbody>
      </table>
      <div class="mt-2 col-md-12"></div>
      <div class="d-flex justify-content-center">
        <button  id="zeigArtikel" class="btn btn-primary fs-s" (click)="showArtikelsinKomm()">Artikeln List verstecken</button>
      </div>
      <div class="mt-2 col-md-12"></div>
    </div>
    <div class="row " >
      <div class="col-md-11">
        <input type="search" class="form-control form-control-sm input-lg rounded" [ngModel]="searchModel" name="searchModel" placeholder = "write artikel name or id" id="" (ngModelChange)="onSearch($event)">
        {{searchModel}}
      </div>
      <div class="col">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
        </svg>
      </div>

  </div>
  <div class="mt-2 col-md-12"></div>
  <div class="table-responsive">
    <table class="table table-bordered table-hover table-sortable">
      <thead>
        <tr>
          <th scope="col" class="fs-s">Artikel id:</th>
          <th scope="col" class="fs-s">Verfugbare Menge</th>
          <th scope="col" class="fs-s">Name</th>
          <th scope="col" class="fs-s">Verkauf Price 2</th>
          <th scope="col" class="fs-s">Verkauf Price</th>
          <th scope="col" class="fs-s">Min Los Menge</th>
          <th scope="col" class="fs-s">Gewicht</th>
          <th scope="col" class="fs-s">Basis Einheit</th>
          <th scope="col" class="fs-s">Liferant</th>
          <th scope="col" class="fs-s">Logistic Beleg Nr</th>
          <th scope="col" class="fs-s">Menge</th>
          <th scope="col" class="fs-s">Artikel zufugen</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of (artikels ? artikels.slice(0,200):[]); let i=index; trackBy : artikelTrackBy;">
          <td class="fs-s">{{item.artId}}</td>
          <td class="fs-s">{{item.total}}</td>
          <td class="fs-s">{{item.name}}</td>
          <td class="fs-s">{{item.verPrice2}}</td>
          <td class="fs-s">{{item.verPrice}}</td>
          <td class="fs-s">{{item.minLosMenge}}</td>
          <td class="fs-s">{{item.gewicht}}</td>
          <td class="fs-s">{{item.basisEinheit}}</td>
          <td class="fs-s">{{dispo[item.liferantId].name}}</td>
          <td class="fs-s"><div class="mb-3">
            <select class="form-select form-select-sm" name="lbn" id="lbn" #lbn (change)="onChange(lbn.value)">
              <option selected *ngFor="let item of logisticBelegNr" [selected]="logisticBelegNr[logisticBelegNr.length -1]" [value]="item" >{{item}}</option>
            </select>
          </div></td>
          <td class="fs-s"><div class="mb-3">
            <input type="number" (click)="checkVerfurbarkeit(i)" [(ngModel)]="artikelMenge[i]"
              class="form-control form-control-sm fs-s"  name="artikelMenge" id="artikelMenge" aria-describedby="helpId" placeholder="">
            <small id="helpId" class="form-text text-muted fs-ss">Gibt Menge Ein, Einzeln!</small>
          </div></td>
          <td class="fs-s"><div class="d-grid gap-2">
            <button type="button" name="" id="" class="btn btn-primary fs-s" (click)="addArtikelToKomm(i, false)" >Add Artikel</button>
          </div></td>
        </tr>

      </tbody>
    </table>
  </div>
</div>
  <div mat-dialog-actions align="end">
    <div class="row col-md-12">

      <div class="col-md-4 justify-content flex-start fs-s">
          Total Gewicht: {{totalGewichtB}}
      </div>
      <div class="col-md-4 justify-content flex-start fs-s">
        Stellpaltze: {{stellplattzeB }}
    </div>
    <div class="col-md-4 justify-content flex-end fs-s">
      <button mat-raised-button matDialogClose color="primary">Close</button>
  </div>
</div>

  </div>
</div>
